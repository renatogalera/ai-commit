# ai-commit

**ai-commit** is an AI-powered tool that automatically generates conventional Git commit messages based on your staged changes. It integrates with OpenAI's API to produce clear, concise, and standardized commit messages that follow the Conventional Commits specification.
Inpired by [insulineru/ai-commit](https://github.com/insulineru/ai-commit)

---

## Table of Contents

- [ai-commit](#ai-commit)
  - [Table of Contents](#table-of-contents)
  - [Features](#features)
  - [Requirements](#requirements)
  - [Installation](#installation)
  - [Configuration](#configuration)
    - [OpenAI API Key](#openai-api-key)
    - [Custom Templates](#custom-templates)
  - [Usage](#usage)
    - [Command-Line Flags](#command-line-flags)
  - [Under development](#under-development)
    - [Environment Variables](#environment-variables)
    - [Running the Tool](#running-the-tool)
  - [Workflow](#workflow)
  - [Examples](#examples)
    - [Example 1: Standard Interactive Commit](#example-1-standard-interactive-commit)
    - [Example 2: Force Commit Without Interaction](#example-2-force-commit-without-interaction)
    - [Example 3: Using a Custom Template](#example-3-using-a-custom-template)
  - [License](#license)

---

## Features

- **AI-Powered Commit Message Generation:** Uses OpenAI's GPT to generate commit messages based on your staged diff.
- **Conventional Commits Compliance:** Generates commit messages that follow the Conventional Commits specification.
- **Customizable Commit Types:** Optionally specify commit types (e.g., feat, fix, docs) or let the tool detect them.
- **Commit Message Templating:** Supports custom templates with placeholders such as `{COMMIT_MESSAGE}` and `{GIT_BRANCH}`.
- **Interactive User Interface:** Provides a terminal UI for reviewing and regenerating commit messages.
- **Force Commit Option:** Automatically commits changes without prompting if desired.

---

## Requirements

- **Git:** The tool operates on your local Git repository.
- **Go:** Required for building from source.
- **OpenAI API Key:** You must have an OpenAI API key to generate commit messages.
- **Network Access:** Internet connection for API calls to OpenAI.

---

## Installation

1. **Clone the Repository:**

   ```bash
   git clone https://github.com/renatogalera/ai-commit.git
   cd ai-commit
   ```

2. **Build the Application:**

   ```bash
   go build -o ai-commit .
   ```

3. **(Optional) Install Globally:**

   You can move the binary to a directory in your PATH (e.g., `/usr/local/bin`):

   ```bash
   sudo mv ai-commit /usr/local/bin/
   ```

---

## Configuration

### OpenAI API Key

Provide your OpenAI API key either via the command-line flag or by setting the environment variable.

- **Command-Line Flag:** `--apiKey YOUR_API_KEY`
- **Environment Variable:** `OPENAI_API_KEY=YOUR_API_KEY`

### Custom Templates

You can define a custom commit message template using the `--template` flag. The template supports the following placeholders:

- `{COMMIT_MESSAGE}`: The commit message generated by the AI.
- `{GIT_BRANCH}`: The current Git branch name.

For example:

```bash
--template "Branch: {GIT_BRANCH}\n\nCommit: {COMMIT_MESSAGE}"
```

---

## Usage

Run the application from within a Git repository with staged changes.

### Command-Line Flags

- `--apiKey`  
  OpenAI API key. If not provided, the tool will check the `OPENAI_API_KEY` environment variable.

- `--commit-type`  
  Specify the commit type (e.g., feat, fix, docs). If not provided, the tool may attempt to determine an appropriate type based on the generated message.

- `--template`  
  Custom commit message template. Use placeholders `{COMMIT_MESSAGE}` and `{GIT_BRANCH}` to include dynamic content.

- `--force`  
  Automatically create the commit without prompting for confirmation.

## Under development

- `--language`  
  Language to generate the commit message in (default is "english").

### Environment Variables

- **OPENAI_API_KEY**  
  Set this environment variable with your OpenAI API key if you prefer not to use the command-line flag.

### Running the Tool

1. **Standard Interactive Mode:**

   In interactive mode, the tool displays the generated commit message and provides options to:
   
   - **Confirm Commit:** Press `y` or `enter` to commit the changes.
   - **Regenerate Message:** Press `r` to regenerate the commit message.
   - **Change Commit Type:** Press `t` to select a different commit type interactively.
   - **Quit:** Press `q` or `ctrl+c` to exit without committing.

   Example:

   ```bash
   ai-commit --apiKey YOUR_API_KEY
   ```

2. **Force Mode (Non-Interactive):**

   If you want to bypass the interactive UI and commit automatically, use the `--force` flag.

   Example:

   ```bash
   ai-commit --apiKey YOUR_API_KEY --force
   ```

---

## Workflow

1. **Verify Git Repository:**  
   The tool first checks if the current directory is a Git repository.

2. **Get Staged Changes:**  
   It retrieves the staged changes (the diff) and filters out lock files from being analyzed.

3. **Generate Diff Prompt:**  
   The tool constructs a prompt including the diff for OpenAI's API.

4. **Call OpenAI API:**  
   A commit message is generated using the OpenAI API based on the prompt.

5. **Sanitize & Format Message:**  
   The generated message is sanitized, formatted with an appropriate commit type, and optionally modified with a custom template.

6. **Interactive Review:**  
   If not in force mode, the tool provides a terminal UI to review, regenerate, or commit the changes.

7. **Commit:**  
   Upon confirmation, the tool creates a Git commit with the generated message.

---

## Examples

### Example 1: Standard Interactive Commit

```bash
ai-commit --apiKey YOUR_API_KEY
```

After staging your changes with `git add`, run the command. Review the commit message in the UI, and press:

- **`y`** or **`enter`** to commit.
- **`r`** to regenerate the message.
- **`t`** to select a different commit type.
- **`q`** to quit.

### Example 2: Force Commit Without Interaction

```bash
ai-commit --apiKey YOUR_API_KEY --force
```

This command automatically commits your changes with the generated commit message without entering interactive mode.

### Example 3: Using a Custom Template

```bash
ai-commit --apiKey YOUR_API_KEY --template "Branch: {GIT_BRANCH}\nCommit Message:\n{COMMIT_MESSAGE}"
```

The generated commit message will be integrated into the template, including the current Git branch.

---

## License

This project is open source and available under the [MIT License](LICENSE.md).

---